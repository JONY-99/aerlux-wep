
const I18N = {
    uz: {
        slogan: "Dasturiy ta'minotda innovatsion yondashuv!",
        "nav.home": "Bosh sahifa", "nav.services": "Xizmatlar", "nav.projects": "Loyihalar", "nav.contact": "Bog'lanish",
        "hero.title": "Biz AERLUX ‚Äî biznesingiz uchun kuchli raqamli yechimlar yaratamiz.",
        "hero.subtitle": "Web saytlar, Telegram botlar, web va mini-ilovalar ‚Äî barchasi bir joyda. Ishonchli, tez va nafis dizayn bilan.",
        "hero.cta": "Bog'lanish", "hero.view": "Loyihalarni ko‚Äòrish", "hero.support": "Qo‚Äòllab-quvvatlash", "hero.quality": "Sifat kafolati",
        "services.title": "Xizmatlar", "services.subtitle": "Sizga mos to‚Äòliq yechimlar",
        "services.web.title": "Web saytlar", "services.web.desc": "Tezkor, SEO-do‚Äòst, zamonaviy dizaynli saytlar.",
        "services.tg.title": "Telegram botlar", "services.tg.desc": "Savdo, qo‚Äòllab-quvvatlash va avtomatlashtirish botlari.",
        "services.webapp.title": "Web ilovalar", "services.webapp.desc": "SPA/PWA, admin panellar, mikroxizmatlar.",
        "services.mini.title": "Mini ilovalar", "services.mini.desc": "Mini-app va integratsiyalar ‚Äî tez ishga tushirish.",
        "projects.title": "Loyihalar", "projects.subtitle": "So‚Äònggi ishlarimiz",
        "contact.title": "Bog‚Äòlanish",
        "form.name": "Ism", "form.phone": "Telefon", "form.msg": "Xabar", "form.more": "Batafsil xabar",
        "form.submit": "Yuborish",
        "contact.findus": "Ijtimoiy tarmoqlar", "contact.text": "Yangiliklar va ishlarimizni kuzating:"
    },
    ru: {
        slogan: "–ò–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –ü–û!",
        "nav.home": "–ì–ª–∞–≤–Ω–∞—è", "nav.services": "–£—Å–ª—É–≥–∏", "nav.projects": "–ü—Ä–æ–µ–∫—Ç—ã", "nav.contact": "–ö–æ–Ω—Ç–∞–∫—Ç—ã",
        "hero.title": "–ú—ã AERLUX ‚Äî —Å–æ–∑–¥–∞—ë–º –º–æ—â–Ω—ã–µ —Ü–∏—Ñ—Ä–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞.",
        "hero.subtitle": "–°–∞–π—Ç—ã, Telegram-–±–æ—Ç—ã, –≤–µ–± –∏ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Äî –≤—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ. –ù–∞–¥—ë–∂–Ω–æ, –±—ã—Å—Ç—Ä–æ, —ç—Å—Ç–µ—Ç–∏—á–Ω–æ.",
        "hero.cta": "–°–≤—è–∑–∞—Ç—å—Å—è", "hero.view": "–°–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–µ–∫—Ç—ã", "hero.support": "–ü–æ–¥–¥–µ—Ä–∂–∫–∞", "hero.quality": "–ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞",
        "services.title": "–£—Å–ª—É–≥–∏", "services.subtitle": "–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –ø–æ–¥ –≤–∞—Å",
        "services.web.title": "–í–µ–±-—Å–∞–π—Ç—ã", "services.web.desc": "–ë—ã—Å—Ç—Ä—ã–µ, SEO-–¥—Ä—É–∂–µ–ª—é–±–Ω—ã–µ, —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∏–∑–∞–π–Ω–æ–º.",
        "services.tg.title": "Telegram-–±–æ—Ç—ã", "services.tg.desc": "–ü—Ä–æ–¥–∞–∂–∏, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è.",
        "services.webapp.title": "–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è", "services.webapp.desc": "SPA/PWA, –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏, –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã.",
        "services.mini.title": "–ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è", "services.mini.desc": "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ –±—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫.",
        "projects.title": "–ü—Ä–æ–µ–∫—Ç—ã", "projects.subtitle": "–ù–∞—à–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–∞–±–æ—Ç—ã",
        "contact.title": "–ö–æ–Ω—Ç–∞–∫—Ç—ã",
        "form.name": "–ò–º—è", "form.phone": "–¢–µ–ª–µ—Ñ–æ–Ω", "form.msg": "–°–æ–æ–±—â–µ–Ω–∏–µ", "form.more": "–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏",
        "form.submit": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å", "form.note": "–î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –æ—Ç–ø—Ä–∞–≤—è—Ç—Å—è –≤ –≥—Ä—É–ø–ø—É Telegram.",
        "contact.findus": "–ú—ã –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö", "contact.text": "–°–ª–µ–¥–∏—Ç–µ –∑–∞ –Ω–æ–≤–æ—Å—Ç—è–º–∏ –∏ –∫–µ–π—Å–∞–º–∏:"
    },
    en: {
        slogan: "Innovative approach in software!",
        "nav.home": "Home", "nav.services": "Services", "nav.projects": "Projects", "nav.contact": "Contact",
        "hero.title": "We are AERLUX ‚Äî building powerful digital products for your business.",
        "hero.subtitle": "Websites, Telegram bots, web & mini-apps ‚Äî all in one place. Reliable, fast, and elegantly designed.",
        "hero.cta": "Contact us", "hero.view": "View projects", "hero.support": "Support", "hero.quality": "Quality assurance",
        "services.title": "Services", "services.subtitle": "End-to-end solutions",
        "services.web.title": "Websites", "services.web.desc": "Fast, SEO-friendly, modern design.",
        "services.tg.title": "Telegram bots", "services.tg.desc": "Sales, support, and automation.",
        "services.webapp.title": "Web apps", "services.webapp.desc": "SPA/PWA, admin panels, microservices.",
        "services.mini.title": "Mini apps", "services.mini.desc": "Integrations and quick launch.",
        "projects.title": "Projects", "projects.subtitle": "Latest works",
        "contact.title": "Contact",
        "form.name": "Name", "form.phone": "Phone", "form.msg": "Message", "form.more": "More details",
        "form.submit": "Send", "form.note": "On submit, data are posted to a Telegram group.",
        "contact.findus": "Socials", "contact.text": "Follow our updates and work:"
    }
};

// =========================
// Projects
// =========================
const PROJECTS = [
    {
        title: "megaparktaxi.uz üåê", date: "2025",
        desc: { uz: "MegaPark Taxi haqida to'liq ma'lumot sayti", ru: "–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Å–∞–π—Ç –æ MegaPark Taxi", en: "A complete website about MegaPark Taxi" },
        features: { uz: ["Telegram kanal", "Lokatsiya", "Tariflar", "Ulanish forma", "Aloqa"], ru: ["–ö–∞–Ω–∞–ª Telegram", "–õ–æ–∫–∞—Ü–∏—è", "–¢–∞—Ä–∏—Ñ—ã", "–§–æ—Ä–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è", "–ö–æ–Ω—Ç–∞–∫—Ç—ã"], en: ["Telegram channel", "Location", "Tariffs", "Join form", "Contacts"] },
        link: "https://megaparktaxi.uz"
    },
    {
        title: "@Yordamchi99bot üöñ", date: "02.03.2025",
        desc: { uz: "Haydovchi va mijozlar uchun qulay aloqa", ru: "–£–¥–æ–±–Ω–∞—è —Å–≤—è–∑—å –¥–ª—è –≤–æ–¥–∏—Ç–µ–ª–µ–π –∏ –∫–ª–∏–µ–Ω—Ç–æ–≤", en: "Convenient communication for drivers and clients" },
        features: { uz: ["Buyurtmalarni tezroq qabul qilish", "Xizmatni tez topish", "Tezkor aloqa"], ru: ["–ë—ã—Å—Ç—Ä—ã–π –ø—Ä–∏—ë–º –∑–∞–∫–∞–∑–æ–≤", "–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ —Å–µ—Ä–≤–∏—Å–∞", "–û–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è —Å–≤—è–∑—å"], en: ["Faster order intake", "Quick service discovery", "Instant communication"] },
        link: "https://t.me/Yordamchi99bot"
    },
    {
        title: "@week99bot üöñ", date: "16.10.2025",
        desc: { uz: "Megapark Taxi haydovchilari uchun motivatsiya va yangiliklar boti", ru: "–ë–æ—Ç –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –∏ –Ω–æ–≤–æ—Å—Ç–µ–π –¥–ª—è –≤–æ–¥–∏—Ç–µ–ª–µ–π Megapark Taxi", en: "Motivation & news bot for Megapark Taxi drivers" },
        features: { uz: ["Har kuni 07:00 da motivatsiya", "@TaxiMegapark dan avtomatik yangiliklar"], ru: ["–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è –≤ 07:00", "–ê–≤—Ç–æ-–Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ @TaxiMegapark"], en: ["Daily motivation at 07:00", "Auto news from @TaxiMegapark"] },
        link: "https://t.me/week99bot"
    }

];

// =========================
// Helpers
// =========================
const $ = (s, root = document) => root.querySelector(s);
const $$ = (s, root = document) => [...root.querySelectorAll(s)];

// ---- Intersection Observer (declare BEFORE use; no TDZ)
var _observer;
function revealInit() {
    if (_observer) _observer.disconnect();
    _observer = new IntersectionObserver((entries) => {
        for (const e of entries) { if (e.isIntersecting) { e.target.classList.add("show"); _observer.unobserve(e.target); } }
    }, { threshold: .14 });
    $$(".reveal").forEach(el => _observer.observe(el));
}

function renderProjects(lang = "uz") {
    const wrap = $("#projectsGrid");
    wrap.innerHTML = "";
    for (const p of PROJECTS) {
        const card = document.createElement("div");
        card.className = "card reveal";
        card.innerHTML = `
          <div class="corner"></div>
          <div class="proj">
            <div class="meta"><span class="pill">${p.date}</span></div>
            <h3>${p.title}</h3>
            <p style="color:var(--sub)">${p.desc[lang] || p.desc.uz}</p>
            <div class="list">
              ${(p.features[lang] || p.features.uz).map(f => `<span class="chip">${f}</span>`).join("")}
            </div>
            <a href="${p.link}" target="_blank" class="link">
              <svg viewBox="0 0 24 24" fill="none"><path d="M14 3h7v7M10 14l11-11M21 21H3V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <span>Open</span>
            </a>
          </div>`;
        wrap.appendChild(card);
    }
    revealInit();
}

function setLang(lang) {
    const dict = I18N[lang] || I18N.uz;
    $$("[data-i]").forEach(el => {
        const key = el.getAttribute("data-i");
        if (dict[key]) el.textContent = dict[key];
    });
    renderProjects(lang);
    document.documentElement.lang = lang;
    localStorage.setItem("aerlux_lang", lang);
    // desktop lang buttons
    $$(".lang-inline button").forEach(b => b.classList.toggle("active", b.dataset.lang === lang));
    // mobile current label
    const langCurrent = $("#langCurrent"); if (langCurrent) langCurrent.textContent = lang.toUpperCase() + " ‚ñæ";
    document.title = (lang === "ru" ? "AERLUX ‚Äî –ò–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –ü–û!"
        : lang === "en" ? "AERLUX ‚Äî Innovative approach in software!"
            : "AERLUX ‚Äî Dasturiy ta'minotda innovatsion yondashuv!");
}

function toggleTheme() {
    const isLight = document.documentElement.classList.toggle("light");
    localStorage.setItem("aerlux_theme", isLight ? "light" : "dark");
}

// =========================
// NAV & LANG wiring
// =========================
const burger1 = document.getElementById("burger1");
const navPanel = document.getElementById("navPanel");

burger1.addEventListener("click", () => {
    const open = navPanel.classList.toggle("open");
    burger1.classList.toggle("open", open);
    burger1.setAttribute("aria-expanded", open ? "true" : "false");
    navPanel.setAttribute("aria-hidden", open ? "false" : "true");
});


const langDropdown = $("#langDropdown");
const langCurrent = $("#langCurrent");
if (langCurrent) {
    langCurrent.addEventListener("click", (e) => {
        e.stopPropagation();
        const isOpen = langDropdown.classList.toggle("open");
        langCurrent.setAttribute("aria-expanded", isOpen ? "true" : "false");
        langDropdown.setAttribute("aria-hidden", isOpen ? "false" : "true");
    });
    document.addEventListener("click", () => langDropdown.classList.remove("open"));
}
// shared lang handlers (desktop + mobile)
$$('[data-lang]').forEach(btn => {
    btn.addEventListener("click", () => {
        const lang = btn.dataset.lang;
        setLang(lang);
        langDropdown && langDropdown.classList.remove("open");
        langCurrent && langCurrent.setAttribute("aria-expanded", "false");
    });
});

// Theme + initial state
const savedTheme = localStorage.getItem("aerlux_theme");
if (savedTheme === "light") document.documentElement.classList.add("light");
$("#themeToggle").addEventListener("click", toggleTheme);

const savedLang = localStorage.getItem("aerlux_lang") || "uz";
setLang(savedLang);
renderProjects(savedLang);
revealInit();

// Active nav highlight
const sections = ["home", "services", "projects", "contact"].map(id => document.getElementById(id));
const navLinks = $$("#menu a");
window.addEventListener("scroll", () => {
    let idx = 0; const top = window.scrollY + 140;
    for (let i = 0; i < sections.length; i++) { if (sections[i].offsetTop <= top) idx = i; }
    navLinks.forEach((a, i) => a.classList.toggle("active", i === idx));
});

// =========================
// Telegram form submission (with full URL-encoding)
// =========================
const form = $("#contactForm");
form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const btn = $("#submitBtn");
    const status = $("#formStatus");
    const lang = localStorage.getItem("aerlux_lang") || "uz";

    btn.disabled = true;
    btn.textContent = (lang === "ru" ? "–û—Ç–ø—Ä–∞–≤–∫–∞..." : lang === "en" ? "Sending..." : "Yuborilmoqda...");
    status.textContent = "";

    const data = Object.fromEntries(new FormData(form).entries());
    const msgText = [
        `üÜï <b>Yangi murojaat (AERLUX)</b>`,
        `üåê <b>Til:</b> ${lang.toUpperCase()}`,
        `üë§ <b>Ism:</b> ${escapeHtml(data.name)}`,
        `üìß <b>Email:</b> ${escapeHtml(data.email)}`,
        `üìû <b>Telefon:</b> ${escapeHtml(data.phone)}`,
        `üí¨ <b>Xabar:</b> ${escapeHtml(data.message)}`,
        data.details ? `üóíÔ∏è <b>Batafsil:</b> ${escapeHtml(data.details)}` : ""
    ].filter(Boolean).join("\n");

    const url = `${TG_ENDPOINT}?chat_id=${encodeURIComponent(TELEGRAM_CHAT_ID)}&parse_mode=HTML&text=${encodeURIComponent(msgText)}`;

    const setOk = () => {
        status.style.color = "var(--ok)";
        status.textContent = (lang === "ru" ? "–£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏." : lang === "en" ? "Sent successfully! We will contact you." : "Muvaffaqiyatli yuborildi! Tez orada aloqaga chiqamiz.");
        form.reset();
    };
    const setErr = () => {
        status.style.color = "var(--err)";
        status.innerHTML = (lang === "ru"
            ? `–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ chat_id –∏ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞. –ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –≤ <a href="https://t.me/AERLUXuz" target="_blank">Telegram</a>.`
            : lang === "en"
                ? `Failed to send. Check chat_id and bot permissions. Or message us on <a href="https://t.me/AERLUXuz" target="_blank">Telegram</a>.`
                : `Yuborilmadi. chat_id va bot huquqlarini tekshiring. Yoki <a href="https://t.me/AERLUXuz" target="_blank">Telegram</a> orqali yozing.`);
    };

    try {
        const r = await fetch(url, { method: "GET" });
        const t = await r.text(); // diagnostika
        console.log("[Telegram response]", r.status, t);
        if (r.ok) { setOk(); }
        else {
            // fallback (no-cors + beacon)
            await fetch(url, { method: "GET", mode: "no-cors" });
            await new Promise(res => { const img = new Image(); img.onload = res; img.onerror = res; img.src = url; });
            setOk();
        }
    } catch (e) {
        console.error(e);
        try {
            await new Promise(res => { const img = new Image(); img.onload = res; img.onerror = res; img.src = url; });
            setOk();
        } catch (_) { setErr(); }
    } finally {
        btn.disabled = false;
        btn.textContent = I18N[lang]["form.submit"];
    }
});

function escapeHtml(s = "") { return s.replace(/[&<>"']/g, m => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;" }[m])); }

// Subtle bg accent
document.addEventListener("scroll", () => {
    const y = Math.min(1, window.scrollY / 600);
    document.body.style.background = `linear-gradient(180deg, rgba(123,127,255,${0.04 + y * 0.08}), transparent), var(--bg)`;
}, { passive: true });



// End of main.js ===============================================================================================================================================



